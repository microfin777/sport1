/*! formstone v0.5.16 [lightbox.js] 2015-05-21 | MIT License | formstone.it */
!function(t,i,e){"use strict";function o(e){if(!R){var o=e.data,a=o.$el,r=o.$object,g=a&&a[0].href&&a[0].href||"",d=a&&a[0].hash&&a[0].hash||"",c=g.toLowerCase().split(".").pop().split(/\#|\?/)[0],p=a?a.data(M+"-type"):"",m="image"===p||t.inArray(c,o.extensions)>-1||"data:image"===g.substr(0,10),u=I(g),H="url"===p||!m&&!u&&"http"===g.substr(0,4)&&!d,W="element"===p||!m&&!u&&!H&&"#"===d.substr(0,1),y=void 0!==r;if(W&&(g=d),!(m||u||H||W||y))return;if(z.killEvent(e),(R=t.extend({},{visible:!1,gallery:{active:!1},isMobile:i.isMobile||o.mobile,isTouch:i.support.touch,isAnimating:!0,oldContentHeight:0,oldContentWidth:0},o)).margin*=2,R.type=m?"image":u?"video":"element",m||u){var x=a.data(M+"-gallery");x&&(R.gallery.active=!0,R.gallery.id=x,R.gallery.$items=t("a[data-lightbox-gallery= "+R.gallery.id+"], a[rel= "+R.gallery.id+"]"),R.gallery.index=R.gallery.$items.index(R.$el),R.gallery.total=R.gallery.$items.length-1)}var C="";R.isMobile||(C+='<div class="'+[_.raw.overlay,R.customClass].join(" ")+'"></div>');var V=[_.raw.base,_.raw.loading,_.raw.animating,R.customClass];R.fixed&&V.push(_.raw.fixed),R.isMobile&&V.push(_.raw.mobile),R.isTouch&&V.push(_.raw.touch),H&&V.push(_.raw.iframed),(W||y)&&V.push(_.raw.inline),C+='<div class="'+V.join(" ")+'">',C+='<button type="button" class="'+_.raw.close+'">'+R.labels.close+"</button>",C+='<span class="'+_.raw.loading_icon+'"></span>',C+='<div class="'+_.raw.container+'">',C+='<div class="'+_.raw.content+'">',(m||u)&&(C+='<div class="'+_.raw.tools+'">',C+='<div class="'+_.raw.controls+'">',R.gallery.active&&(C+='<button type="button" class="'+[_.raw.control,_.raw.control_previous].join(" ")+'">'+R.labels.previous+"</button>",C+='<button type="button" class="'+[_.raw.control,_.raw.control_next].join(" ")+'">'+R.labels.next+"</button>"),R.isMobile&&R.isTouch&&(C+='<button type="button" class="'+[_.raw.caption_toggle].join(" ")+'">'+R.labels.captionClosed+"</button>"),C+="</div>",C+='<div class="'+_.raw.meta+'">',R.gallery.active&&(C+='<p class="'+_.raw.position+'"',R.gallery.total<1&&(C+=' style="display: none;"'),C+=">",C+='<span class="'+_.raw.position_current+'">'+(R.gallery.index+1)+"</span> ",C+=R.labels.count,C+=' <span class="'+_.raw.position_total+'">'+(R.gallery.total+1)+"</span>",C+="</p>"),C+='<div class="'+_.raw.caption+'">',C+=R.formatter.call(a,o),C+="</div></div>",C+="</div>"),C+="</div></div></div>",O.append(C),R.$overlay=t(_.overlay),R.$lightbox=t(_.base),R.$close=t(_.close),R.$container=t(_.container),R.$content=t(_.content),R.$tools=t(_.tools),R.$meta=t(_.meta),R.$position=t(_.position),R.$caption=t(_.caption),R.$controlBox=t(_.controls),R.$controls=t(_.control),R.isMobile?(R.paddingVertical=R.$close.outerHeight(),R.paddingHorizontal=0,R.mobilePaddingVertical=parseInt(R.$content.css("paddingTop"),10)+parseInt(R.$content.css("paddingBottom"),10),R.mobilePaddingHorizontal=parseInt(R.$content.css("paddingLeft"),10)+parseInt(R.$content.css("paddingRight"),10)):(R.paddingVertical=parseInt(R.$lightbox.css("paddingTop"),10)+parseInt(R.$lightbox.css("paddingBottom"),10),R.paddingHorizontal=parseInt(R.$lightbox.css("paddingLeft"),10)+parseInt(R.$lightbox.css("paddingRight"),10),R.mobilePaddingVertical=0,R.mobilePaddingHorizontal=0),R.contentHeight=R.$lightbox.outerHeight()-R.paddingVertical,R.contentWidth=R.$lightbox.outerWidth()-R.paddingHorizontal,R.controlHeight=R.$controls.outerHeight(),l(),R.gallery.active&&f(),L.on(j.keyDown,b),O.on(j.clickTouchStart,[_.overlay,_.close].join(", "),n),R.gallery.active&&R.$lightbox.on(j.clickTouchStart,_.control,v),R.isMobile&&R.isTouch&&R.$lightbox.on(j.clickTouchStart,_.caption_toggle,s),R.$lightbox.transition({property:"opacity"},(function(){m?h(g):u?w(g):H?function(i){i+=i.indexOf("?")>-1?"&"+R.requestKey+"=true":"?"+R.requestKey+"=true",$(t('<iframe class="'+_.raw.iframe+'" src="'+i+'"></iframe>'))}(g):W?function(i){$(t(i).find("> :first-child").clone())}(g):y&&$(R.$object)})).addClass(_.raw.open),R.$overlay.addClass(_.raw.open)}}function a(t){"object"!=typeof t&&(R.targetHeight=arguments[0],R.targetWidth=arguments[1]),"element"===R.type?W(R.$content.find("> :first-child")):"image"===R.type?p():"video"===R.type&&u(),g()}function n(t){z.killEvent(t),R&&(R.$lightbox.transition("destroy"),R.$container.transition("destroy"),R.$lightbox.addClass(_.raw.animating).transition({property:"opacity"},(function(){R.$lightbox.off(j.namespace),R.$container.off(j.namespace),L.off(j.namespace),O.off(j.namespace),R.$overlay.remove(),R.$lightbox.remove(),R=null,L.trigger(j.close)})),R.$lightbox.removeClass(_.raw.open),R.$overlay.removeClass(_.raw.open),R.isMobile&&P.removeClass(T.lock))}function r(){var t=d();!R.isMobile&&R.duration,R.isMobile||R.$controls.css({marginTop:(R.contentHeight-R.controlHeight-R.metaHeight)/2}),!R.visible&&R.isMobile&&R.gallery.active&&R.$content.touch({axis:"x",swipe:!0}).on(j.swipe,x),R.$lightbox.transition({property:R.contentHeight!==R.oldContentHeight?"height":"width"},(function(){R.$container.transition({property:"opacity"},(function(){R.$lightbox.removeClass(_.raw.animating),R.isAnimating=!1})),R.$lightbox.removeClass(_.raw.loading),R.visible=!0,L.trigger(j.open),R.gallery.active&&H()})),R.isMobile||R.$lightbox.css({height:R.contentHeight+R.paddingVertical,width:R.contentWidth+R.paddingHorizontal,top:R.fixed?0:t.top});var i=R.oldContentHeight!==R.contentHeight||R.oldContentWidth!==R.contentWidth;(R.isMobile||!i)&&R.$lightbox.transition("resolve"),R.oldContentHeight=R.contentHeight,R.oldContentWidth=R.contentWidth,R.isMobile&&P.addClass(T.lock)}function g(){if(R.visible&&!R.isMobile){var t=d();R.$controls.css({marginTop:(R.contentHeight-R.controlHeight-R.metaHeight)/2}),R.$lightbox.css({height:R.contentHeight+R.paddingVertical,width:R.contentWidth+R.paddingHorizontal,top:R.fixed?0:t.top})}}function l(){var t=d();R.$lightbox.css({top:R.fixed?0:t.top})}function d(){if(R.isMobile)return{left:0,top:0};var t={left:(i.windowWidth-R.contentWidth-R.paddingHorizontal)/2,top:R.top<=0?(i.windowHeight-R.contentHeight-R.paddingVertical)/2:R.top};return!0!==R.fixed&&(t.top+=L.scrollTop()),t}function s(t){z.killEvent(t),R.captionOpen?c():(R.$lightbox.addClass(_.raw.caption_open).find(_.caption_toggle).text(R.labels.captionOpen),R.captionOpen=!0)}function c(){R.$lightbox.removeClass(_.raw.caption_open).find(_.caption_toggle).text(R.labels.captionClosed),R.captionOpen=!1}function h(i){R.$image=t("<img>"),R.$image.one(j.load,(function(){var t=function(t){var i=t[0],e=new Image;return void 0!==i.naturalHeight?{naturalHeight:i.naturalHeight,naturalWidth:i.naturalWidth}:"img"===i.tagName.toLowerCase()&&(e.src=i.src,{naturalHeight:e.height,naturalWidth:e.width})}(R.$image);R.naturalHeight=t.naturalHeight,R.naturalWidth=t.naturalWidth,R.retina&&(R.naturalHeight/=2,R.naturalWidth/=2),R.$content.prepend(R.$image),""===R.$caption.html()?R.$caption.hide():R.$caption.show(),p(),r()})).error(y).attr("src",i).addClass(_.raw.image),(R.$image[0].complete||4===R.$image[0].readyState)&&R.$image.trigger(j.load)}function p(){var t=0;for(R.windowHeight=R.viewportHeight=i.windowHeight-R.mobilePaddingVertical-R.paddingVertical,R.windowWidth=R.viewportWidth=i.windowWidth-R.mobilePaddingHorizontal-R.paddingHorizontal,R.contentHeight=1/0,R.contentWidth=1/0,R.imageMarginTop=0,R.imageMarginLeft=0;R.contentHeight>R.viewportHeight&&2>t;)R.imageHeight=0===t?R.naturalHeight:R.$image.outerHeight(),R.imageWidth=0===t?R.naturalWidth:R.$image.outerWidth(),R.metaHeight=0===t?0:R.metaHeight,R.spacerHeight=0===t?0:R.spacerHeight,0===t&&(R.ratioHorizontal=R.imageHeight/R.imageWidth,R.ratioVertical=R.imageWidth/R.imageHeight,R.isWide=R.imageWidth>R.imageHeight),R.imageHeight<R.minHeight&&(R.minHeight=R.imageHeight),R.imageWidth<R.minWidth&&(R.minWidth=R.imageWidth),R.isMobile?(R.isTouch?(R.$controlBox.css({width:i.windowWidth}),R.spacerHeight=R.$controls.outerHeight(!0)):(R.$tools.css({width:i.windowWidth}),R.spacerHeight=R.$tools.outerHeight(!0)),R.contentHeight=R.viewportHeight,R.contentWidth=R.viewportWidth,m(),R.imageMarginTop=(R.contentHeight-R.targetImageHeight-R.spacerHeight)/2,R.imageMarginLeft=(R.contentWidth-R.targetImageWidth)/2):(0===t&&(R.viewportHeight-=R.margin+R.paddingVertical,R.viewportWidth-=R.margin+R.paddingHorizontal),R.viewportHeight-=R.metaHeight,m(),R.contentHeight=R.targetImageHeight,R.contentWidth=R.targetImageWidth),R.isMobile||R.isTouch||R.$meta.css({width:R.contentWidth}),R.$image.css({height:R.targetImageHeight,width:R.targetImageWidth,marginTop:R.imageMarginTop,marginLeft:R.imageMarginLeft}),R.isMobile||(R.metaHeight=R.$meta.outerHeight(!0),R.contentHeight+=R.metaHeight),t++}function m(){var t=R.isMobile?R.contentHeight-R.spacerHeight:R.viewportHeight,i=R.isMobile?R.contentWidth:R.viewportWidth;R.isWide?(R.targetImageWidth=i,R.targetImageHeight=R.targetImageWidth*R.ratioHorizontal,R.targetImageHeight>t&&(R.targetImageHeight=t,R.targetImageWidth=R.targetImageHeight*R.ratioVertical)):(R.targetImageHeight=t,R.targetImageWidth=R.targetImageHeight*R.ratioVertical,R.targetImageWidth>i&&(R.targetImageWidth=i,R.targetImageHeight=R.targetImageWidth*R.ratioHorizontal)),(R.targetImageWidth>R.imageWidth||R.targetImageHeight>R.imageHeight)&&(R.targetImageHeight=R.imageHeight,R.targetImageWidth=R.imageWidth),(R.targetImageWidth<R.minWidth||R.targetImageHeight<R.minHeight)&&(R.targetImageWidth<R.minWidth?(R.targetImageWidth=R.minWidth,R.targetImageHeight=R.targetImageWidth*R.ratioHorizontal):(R.targetImageHeight=R.minHeight,R.targetImageWidth=R.targetImageHeight*R.ratioVertical))}function w(i){var e=i.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i),o=i.match(/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/),a=null!==e?"//www.youtube.com/embed/"+e[1]:"//player.vimeo.com/video/"+o[3];R.$videoWrapper=t('<div class="'+_.raw.videoWrapper+'"></div>'),R.$video=t('<iframe class="'+_.raw.video+'" seamless="seamless"></iframe>'),R.$video.attr("src",a).addClass(_.raw.video).prependTo(R.$videoWrapper),R.$content.prepend(R.$videoWrapper),u(),r()}function u(){R.windowHeight=R.viewportHeight=i.windowHeight-R.mobilePaddingVertical-R.paddingVertical,R.windowWidth=R.viewportWidth=i.windowWidth-R.mobilePaddingHorizontal-R.paddingHorizontal,R.videoMarginTop=0,R.videoMarginLeft=0,R.isMobile?(R.isTouch?(R.$controlBox.css({width:i.windowWidth}),R.spacerHeight=R.$controls.outerHeight(!0)):(R.$tools.css({width:i.windowWidth}),R.spacerHeight=R.$tools.outerHeight(!0)),R.viewportHeight-=R.spacerHeight,R.targetVideoWidth=R.viewportWidth,R.targetVideoHeight=R.targetVideoWidth*R.videoRatio,R.targetVideoHeight>R.viewportHeight&&(R.targetVideoHeight=R.viewportHeight,R.targetVideoWidth=R.targetVideoHeight/R.videoRatio),R.videoMarginTop=(R.viewportHeight-R.targetVideoHeight)/2,R.videoMarginLeft=(R.viewportWidth-R.targetVideoWidth)/2):(R.viewportHeight=R.windowHeight-R.margin,R.viewportWidth=R.windowWidth-R.margin,R.targetVideoWidth=R.videoWidth>R.viewportWidth?R.viewportWidth:R.videoWidth,R.targetVideoWidth<R.minWidth&&(R.targetVideoWidth=R.minWidth),R.targetVideoHeight=R.targetVideoWidth*R.videoRatio,R.contentHeight=R.targetVideoHeight,R.contentWidth=R.targetVideoWidth),R.isMobile||R.isTouch||R.$meta.css({width:R.contentWidth}),R.$videoWrapper.css({height:R.targetVideoHeight,width:R.targetVideoWidth,marginTop:R.videoMarginTop,marginLeft:R.videoMarginLeft}),R.isMobile||(R.metaHeight=R.$meta.outerHeight(!0),R.contentHeight=R.targetVideoHeight+R.metaHeight)}function H(){var i="";R.gallery.index>0&&(I(i=R.gallery.$items.eq(R.gallery.index-1).attr("href"))||t('<img src="'+i+'">')),R.gallery.index<R.gallery.total&&(I(i=R.gallery.$items.eq(R.gallery.index+1).attr("href"))||t('<img src="'+i+'">'))}function v(i){z.killEvent(i);var e=t(i.currentTarget);R.isAnimating||e.hasClass(_.raw.control_disabled)||(R.isAnimating=!0,c(),R.gallery.index+=e.hasClass(_.raw.control_next)?1:-1,R.gallery.index>R.gallery.total&&(R.gallery.index=R.infinite?0:R.gallery.total),R.gallery.index<0&&(R.gallery.index=R.infinite?R.gallery.total:0),R.$lightbox.addClass([_.raw.loading,_.raw.animating].join(" ")),R.$container.transition({property:"opacity"},(function(){void 0!==R.$image&&R.$image.remove(),void 0!==R.$videoWrapper&&R.$videoWrapper.remove(),R.$el=R.gallery.$items.eq(R.gallery.index),R.$caption.html(R.formatter.call(R.$el,R)),R.$position.find(_.position_current).html(R.gallery.index+1);var t=R.$el.attr("href");I(t)?w(t):h(t),f()})))}function f(){R.$controls.removeClass(_.raw.control_disabled),R.infinite||(0===R.gallery.index&&R.$controls.filter(_.control_previous).addClass(T.control_disabled),R.gallery.index===R.gallery.total&&R.$controls.filter(_.control_next).addClass(T.control_disabled))}function b(t){!R.gallery.active||37!==t.keyCode&&39!==t.keyCode?27===t.keyCode&&R.$close.trigger(j.click):(z.killEvent(t),R.$controls.filter(37===t.keyCode?_.control_previous:_.control_next).trigger(j.click))}function $(t){R.$content.append(t),W(t),r()}function W(t){R.windowHeight=i.windowHeight-R.mobilePaddingVertical-R.paddingVertical,R.windowWidth=i.windowWidth-R.mobilePaddingHorizontal-R.paddingHorizontal,R.objectHeight=t.outerHeight(!0),R.objectWidth=t.outerWidth(!0),R.targetHeight=R.targetHeight||(R.$el?R.$el.data(M+"-height"):null),R.targetWidth=R.targetWidth||(R.$el?R.$el.data(M+"-width"):null),R.maxHeight=R.windowHeight<0?R.minHeight:R.windowHeight,R.isIframe=t.is("iframe"),R.objectMarginTop=0,R.objectMarginLeft=0,R.isMobile||(R.windowHeight-=R.margin,R.windowWidth-=R.margin),R.contentHeight=R.targetHeight?R.targetHeight:R.isIframe||R.isMobile?R.windowHeight:R.objectHeight,R.contentWidth=R.targetWidth?R.targetWidth:R.isIframe||R.isMobile?R.windowWidth:R.objectWidth,(R.isIframe||R.isObject)&&R.isMobile?(R.contentHeight=R.windowHeight,R.contentWidth=R.windowWidth):R.isObject&&(R.contentHeight=R.contentHeight>R.windowHeight?R.windowHeight:R.contentHeight,R.contentWidth=R.contentWidth>R.windowWidth?R.windowWidth:R.contentWidth)}function y(){var i=t('<div class="'+_.raw.error+'"><p>Error Loading Resource</p></div>');R.type="element",R.$tools.remove(),R.$image.off(j.namespace),$(i)}function x(t){R.captionOpen||R.$controls.filter("left"===t.directionX?_.control_next:_.control_previous).trigger(j.click)}function I(t){return t.indexOf("youtube.com")>-1||t.indexOf("youtu.be")>-1||t.indexOf("vimeo.com")>-1}var C=i.Plugin("lightbox",{widget:!0,defaults:{customClass:"",extensions:["jpg","sjpg","jpeg","png","gif"],fixed:!1,formatter:function(){var t=this.attr("title"),i=!(undefined===t||!t)&&t.replace(/^\s+|\s+$/g,"");return i?'<p class="caption">'+i+"</p>":""},infinite:!1,labels:{close:"Close",count:"of",next:"Next",previous:"Previous",captionClosed:"View Caption",captionOpen:"Close Caption"},margin:50,minHeight:100,minWidth:100,mobile:!1,retina:!1,requestKey:"fs-lightbox",top:0,videoRatio:.5625,videoWidth:800},classes:["loading","animating","fixed","mobile","touch","inline","iframed","open","overlay","close","loading_icon","container","content","image","video","video_wrapper","tools","meta","controls","control","control_previous","control_next","control_disabled","position","position_current","position_total","caption_toggle","caption","caption_open","iframe","error","lock"],events:{open:"open",close:"close",swipe:"swipe"},methods:{_setup:function(){O=i.$body,P=t("html, body")},_construct:function(t){this.on(j.click,t,o)},_destruct:function(){n(),this.off(j.namespace)},_resize:function(){R&&a()},resize:a},utilities:{_initialize:function(i,e){i instanceof t&&o.apply(k,[{data:t.extend({},{$object:i},V,e||{})}])},close:n}}),M=C.namespace,V=C.defaults,_=C.classes,T=_.raw,j=C.events,z=C.functions,k=i.window,L=i.$window,O=null,P=null,R=null}(jQuery,Formstone);